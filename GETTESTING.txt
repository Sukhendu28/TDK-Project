USE [PxC_DB]
GO
/****** Object:  StoredProcedure [dbo].[GETTESTING]    Script Date: 09-02-2020 11:41:40 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[GETTESTING]
AS
BEGIN
SET NOCOUNT ON

DECLARE @ENDDATE datetime
SET @ENDDATE = GETDATE()

DECLARE @STARTDATE datetime
SET @STARTDATE = DATEADD(N, -1, GETDATE())

DECLARE @DAY datetime
SET @DAY = CAST( GETDATE() AS DATE)

DECLARE @DAYNEW datetime
SET @DAYNEW = DATEADD(DD, -1, CAST( GETDATE() AS DATE))

DECLARE @ENDDATENEW datetime
SET @ENDDATENEW =  CONVERT(VARCHAR, GETDATE(), 108)

DECLARE @SHIFT NVARCHAR(26)

IF (@ENDDATENEW >= '13:58:01' AND @ENDDATENEW < '20:59:01' )
BEGIN
 SET @SHIFT = 'A'
END
ELSE IF (@ENDDATENEW >= '21:58:01' AND @ENDDATENEW < '23:58:01')
BEGIN
 SET @SHIFT = 'B'
END
ELSE IF (@ENDDATENEW >= '05:50:01' AND @ENDDATENEW < '12:58:01')
BEGIN
 SET @SHIFT = 'C'
END

INSERT INTO [PxC_DB].[dbo].[TPA 12_2] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'TPA 12_2%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'TPA 12_2 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[TPA 12_2_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'TPA 12_2 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[TPA 12_2_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[TPA 12_2]
SET    [PxC_DB].[dbo].[TPA 12_2].StartTime = [PxC_DB].[dbo].[TPA 12_2_TEST].[StartTime],
       [PxC_DB].[dbo].[TPA 12_2].Duration = [PxC_DB].[dbo].[TPA 12_2_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[TPA 12_2_TEST]
WHERE [PxC_DB].[dbo].[TPA 12_2_TEST].[TraID] = [PxC_DB].[dbo].[TPA 12_2].[TraID] AND [PxC_DB].[dbo].[TPA 12_2].StartTime IS NULL AND [PxC_DB].[dbo].[TPA 12_2].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[TPA 12_2]
SET Reason = 'TPA 12_2 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[TPA 12_2_TEST]

UPDATE [PxC_DB].[dbo].[TPA 12_2]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_2]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_2]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_2]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_2] 
	SET [Machine Name] = 'TPA 12_2' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_2]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[TPA 12_2]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[TPA 12_2_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[TPA 12_2_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 12_2_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[TPA 12_2_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_2] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[TPA 12_2_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'TPA 12_2'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 12_2_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[TPA 12_4] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'TPA 12_4%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'TPA 12_4 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[TPA 12_4_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'TPA 12_4 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[TPA 12_4_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[TPA 12_4]
SET    [PxC_DB].[dbo].[TPA 12_4].StartTime = [PxC_DB].[dbo].[TPA 12_4_TEST].[StartTime],
       [PxC_DB].[dbo].[TPA 12_4].Duration = [PxC_DB].[dbo].[TPA 12_4_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[TPA 12_4_TEST]
WHERE [PxC_DB].[dbo].[TPA 12_4_TEST].[TraID] = [PxC_DB].[dbo].[TPA 12_4].[TraID] AND [PxC_DB].[dbo].[TPA 12_4].StartTime IS NULL AND [PxC_DB].[dbo].[TPA 12_4].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[TPA 12_4]
SET Reason = 'TPA 12_4 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[TPA 12_4_TEST]

UPDATE [PxC_DB].[dbo].[TPA 12_4]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_4]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_4]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_4]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_4] 
	SET [Machine Name] = 'TPA 12_4' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_4]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[TPA 12_4]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[TPA 12_4_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[TPA 12_4_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 12_4_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[TPA 12_4_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_4] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[TPA 12_4_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'TPA 12_4'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 12_4_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[RLP_15] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'RLP_15%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'RLP_15 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[RLP_15_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'RLP_15 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[RLP_15_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[RLP_15]
SET    [PxC_DB].[dbo].[RLP_15].StartTime = [PxC_DB].[dbo].[RLP_15_TEST].[StartTime],
       [PxC_DB].[dbo].[RLP_15].Duration = [PxC_DB].[dbo].[RLP_15_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[RLP_15_TEST]
WHERE [PxC_DB].[dbo].[RLP_15_TEST].[TraID] = [PxC_DB].[dbo].[RLP_15].[TraID] AND [PxC_DB].[dbo].[RLP_15].StartTime IS NULL AND [PxC_DB].[dbo].[RLP_15].Duration IS NULL

UPDATE [PxC_DB].[dbo].[RLP_15] 
SET Reason = 'RLP_15 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[RLP_15_TEST]

UPDATE [PxC_DB].[dbo].[RLP_15]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_15]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_15]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_15]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_15] 
	SET [Machine Name] = 'RLP_15' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_15]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[RLP_15]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[RLP_15_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[RLP_15_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_15_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[RLP_15_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_15] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[RLP_15_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'RLP_15'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_15_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[RLP_13] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'RLP_13%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'RLP_13 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[RLP_13_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'RLP_13 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[RLP_13_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[RLP_13]
SET    [PxC_DB].[dbo].[RLP_13].StartTime = [PxC_DB].[dbo].[RLP_13_TEST].[StartTime],
       [PxC_DB].[dbo].[RLP_13].Duration = [PxC_DB].[dbo].[RLP_13_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[RLP_13_TEST]
WHERE [PxC_DB].[dbo].[RLP_13_TEST].[TraID] = [PxC_DB].[dbo].[RLP_13].[TraID] AND [PxC_DB].[dbo].[RLP_13].StartTime IS NULL AND [PxC_DB].[dbo].[RLP_13].Duration IS NULL

UPDATE [PxC_DB].[dbo].[RLP_13] 
SET Reason = 'RLP_13 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[RLP_13_TEST]


UPDATE [PxC_DB].[dbo].[RLP_13]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_13]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_13]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_13]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL


UPDATE [PxC_DB].[dbo].[RLP_13] 
	SET [Machine Name] = 'RLP_13' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_13]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[RLP_13]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[RLP_13_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_13]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')

UPDATE [PxC_DB].[dbo].[RLP_13_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_13_Stoppage])

INSERT INTO [PxC_DB].[dbo].[RLP_13_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_13] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[RLP_13_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'RLP_13'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_13_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[TPA 35_1] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'TPA 35_1%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'TPA 35_1 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[TPA 35_1_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'TPA 35_1 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[TPA 35_1_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[TPA 35_1]
SET    [PxC_DB].[dbo].[TPA 35_1].StartTime = [PxC_DB].[dbo].[TPA 35_1_TEST].[StartTime],
       [PxC_DB].[dbo].[TPA 35_1].Duration = [PxC_DB].[dbo].[TPA 35_1_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[TPA 35_1_TEST]
WHERE [PxC_DB].[dbo].[TPA 35_1_TEST].[TraID] = [PxC_DB].[dbo].[TPA 35_1].[TraID] AND [PxC_DB].[dbo].[TPA 35_1].StartTime IS NULL AND [PxC_DB].[dbo].[TPA 35_1].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[TPA 35_1]
SET Reason = 'TPA 35_1 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[TPA 35_1_TEST]

UPDATE [PxC_DB].[dbo].[TPA 35_1]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 35_1]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 35_1]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 35_1]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 35_1] 
	SET [Machine Name] = 'TPA 35_1' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 35_1]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[TPA 35_1]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[TPA 35_1_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 35_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[TPA 35_1_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 35_1_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[TPA 35_1_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 35_1] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[TPA 35_1_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'TPA 35_1'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 35_1_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[RLP_9] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'RLP_9%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'RLP_9 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[RLP_9_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'RLP_9 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[RLP_9_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[RLP_9]
SET    [PxC_DB].[dbo].[RLP_9].StartTime = [PxC_DB].[dbo].[RLP_9_TEST].[StartTime],
       [PxC_DB].[dbo].[RLP_9].Duration = [PxC_DB].[dbo].[RLP_9_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[RLP_9_TEST]
WHERE [PxC_DB].[dbo].[RLP_9_TEST].[TraID] = [PxC_DB].[dbo].[RLP_9].[TraID] AND [PxC_DB].[dbo].[RLP_9].StartTime IS NULL AND [PxC_DB].[dbo].[RLP_9].Duration IS NULL

UPDATE [PxC_DB].[dbo].[RLP_9] 
SET Reason = 'RLP_9 - Idle Time' WHERE Reason IS NULL 

TRUNCATE TABLE [PxC_DB].[dbo].[RLP_9_TEST]

UPDATE [PxC_DB].[dbo].[RLP_9]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_9]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_9]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_9]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_9] 
	SET [Machine Name] = 'RLP_9' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_9]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[RLP_9]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[RLP_9_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')



UPDATE [PxC_DB].[dbo].[RLP_9_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_9_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[RLP_9_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_9] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[RLP_9_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'RLP_9'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_9_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[TPA 12_1] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'TPA 12_1%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'TPA 12_1 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[TPA 12_1_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'TPA 12_1 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[TPA 12_1_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[TPA 12_1]
SET    [PxC_DB].[dbo].[TPA 12_1].StartTime = [PxC_DB].[dbo].[TPA 12_1_TEST].[StartTime],
       [PxC_DB].[dbo].[TPA 12_1].Duration = [PxC_DB].[dbo].[TPA 12_1_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[TPA 12_1_TEST]
WHERE [PxC_DB].[dbo].[TPA 12_1_TEST].[TraID] = [PxC_DB].[dbo].[TPA 12_1].[TraID] AND [PxC_DB].[dbo].[TPA 12_1].StartTime IS NULL AND [PxC_DB].[dbo].[TPA 12_1].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[TPA 12_1]
SET Reason = 'TPA 12_1 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[TPA 12_1_TEST]

UPDATE [PxC_DB].[dbo].[TPA 12_1]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_1]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_1]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_1]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_1] 
	SET [Machine Name] = 'TPA 12_1' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_1]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[TPA 12_1]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[TPA 12_1_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[TPA 12_1_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 12_1_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[TPA 12_1_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_1] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[TPA 12_1_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'TPA 12_1'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 12_1_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[TPA 16_3] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'TPA 16_3%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'TPA 16_3 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[TPA 16_3_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'TPA 16_3 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[TPA 16_3_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[TPA 16_3]
SET    [PxC_DB].[dbo].[TPA 16_3].StartTime = [PxC_DB].[dbo].[TPA 16_3_TEST].[StartTime],
       [PxC_DB].[dbo].[TPA 16_3].Duration = [PxC_DB].[dbo].[TPA 16_3_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[TPA 16_3_TEST]
WHERE [PxC_DB].[dbo].[TPA 16_3_TEST].[TraID] = [PxC_DB].[dbo].[TPA 16_3].[TraID] AND [PxC_DB].[dbo].[TPA 16_3].StartTime IS NULL AND [PxC_DB].[dbo].[TPA 16_3].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[TPA 16_3]
SET Reason = 'TPA 16_3 - Idle Time' WHERE Reason IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_3] 
SET [Reason] = 'TPA 16_3 - Idle_Time' where [Reason] = 'TPA 16_3 - Stop' 

TRUNCATE TABLE [PxC_DB].[dbo].[TPA 16_3_TEST]

UPDATE [PxC_DB].[dbo].[TPA 16_3]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_3]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_3]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_3]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_3] 
	SET [Machine Name] = 'TPA 16_3' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_3]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[TPA 16_3]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[TPA 16_3_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[TPA 16_3_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 16_3_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[TPA 16_3_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_3] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[TPA 16_3_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'TPA 16_3'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 16_3_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[TPA 16_4] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'TPA 16_4%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'TPA 16_4 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[TPA 16_4_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'TPA 16_4 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[TPA 16_4_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[TPA 16_4]
SET    [PxC_DB].[dbo].[TPA 16_4].StartTime = [PxC_DB].[dbo].[TPA 16_4_TEST].[StartTime],
       [PxC_DB].[dbo].[TPA 16_4].Duration = [PxC_DB].[dbo].[TPA 16_4_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[TPA 16_4_TEST]
WHERE [PxC_DB].[dbo].[TPA 16_4_TEST].[TraID] = [PxC_DB].[dbo].[TPA 16_4].[TraID] AND [PxC_DB].[dbo].[TPA 16_4].StartTime IS NULL AND [PxC_DB].[dbo].[TPA 16_4].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[TPA 16_4]
SET Reason = 'TPA 16_4 - Idle Time' WHERE Reason IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_4]
SET [Reason] = 'TPA 16_4 - Idle_Time' where [Reason] = 'TPA 16_4 - Stop' 

TRUNCATE TABLE [PxC_DB].[dbo].[TPA 16_4_TEST]

UPDATE [PxC_DB].[dbo].[TPA 16_4]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_4]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_4]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_4]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_4] 
	SET [Machine Name] = 'TPA 16_4' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_4]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[TPA 16_4]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[TPA 16_4_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[TPA 16_4_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 16_4_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[TPA 16_4_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_4] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[TPA 16_4_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'TPA 16_4'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 16_4_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[TPA 16_5] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'TPA 16_5%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'TPA 16_5 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[TPA 16_5_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'TPA 16_5 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[TPA 16_5_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[TPA 16_5]
SET    [PxC_DB].[dbo].[TPA 16_5].StartTime = [PxC_DB].[dbo].[TPA 16_5_TEST].[StartTime],
       [PxC_DB].[dbo].[TPA 16_5].Duration = [PxC_DB].[dbo].[TPA 16_5_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[TPA 16_5_TEST]
WHERE [PxC_DB].[dbo].[TPA 16_5_TEST].[TraID] = [PxC_DB].[dbo].[TPA 16_5].[TraID] AND [PxC_DB].[dbo].[TPA 16_5].StartTime IS NULL AND [PxC_DB].[dbo].[TPA 16_5].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[TPA 16_5]
SET Reason = 'TPA 16_5 - Idle Time' WHERE Reason IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_5] 
SET [Reason] = 'TPA 16_5 - Idle Time' where [Reason] = 'TPA 16_5 - Stop' 

TRUNCATE TABLE [PxC_DB].[dbo].[TPA 16_5_TEST]

UPDATE [PxC_DB].[dbo].[TPA 16_5]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_5]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_5]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_5]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_5] 
	SET [Machine Name] = 'TPA 16_5' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_5]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[TPA 16_5]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[TPA 16_5_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[TPA 16_5_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 16_5_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[TPA 16_5_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_5] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[TPA 16_5_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'TPA 16_5'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 16_5_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[TPA 16_6] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'TPA 16_6%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'TPA 16_6 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[TPA 16_6_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'TPA 16_6 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[TPA 16_6_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[TPA 16_6]
SET    [PxC_DB].[dbo].[TPA 16_6].StartTime = [PxC_DB].[dbo].[TPA 16_6_TEST].[StartTime],
       [PxC_DB].[dbo].[TPA 16_6].Duration = [PxC_DB].[dbo].[TPA 16_6_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[TPA 16_6_TEST]
WHERE [PxC_DB].[dbo].[TPA 16_6_TEST].[TraID] = [PxC_DB].[dbo].[TPA 16_6].[TraID] AND [PxC_DB].[dbo].[TPA 16_6].StartTime IS NULL AND [PxC_DB].[dbo].[TPA 16_6].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[TPA 16_6]
SET Reason = 'TPA 16_6 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[TPA 16_6_TEST]

UPDATE [PxC_DB].[dbo].[TPA 16_6]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_6]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_6]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_6]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_6] 
	SET [Machine Name] = 'TPA 16_6' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 16_6]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[TPA 16_6]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[TPA 16_6_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 16_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[TPA 16_6_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 16_6_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[TPA 16_6_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 16_6] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[TPA 16_6_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'TPA 16_6'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 16_6_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[RLP_17] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'RLP_17%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'RLP_17 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[RLP_17_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'RLP_17 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[RLP_17_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[RLP_17]
SET    [PxC_DB].[dbo].[RLP_17].StartTime = [PxC_DB].[dbo].[RLP_17_TEST].[StartTime],
       [PxC_DB].[dbo].[RLP_17].Duration = [PxC_DB].[dbo].[RLP_17_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[RLP_17_TEST]
WHERE [PxC_DB].[dbo].[RLP_17_TEST].[TraID] = [PxC_DB].[dbo].[RLP_17].[TraID] AND [PxC_DB].[dbo].[RLP_17].StartTime IS NULL AND [PxC_DB].[dbo].[RLP_17].Duration IS NULL

UPDATE [PxC_DB].[dbo].[RLP_17] 
SET Reason = 'RLP_17 - Idle Time' WHERE Reason IS NULL 

TRUNCATE TABLE [PxC_DB].[dbo].[RLP_17_TEST]

UPDATE [PxC_DB].[dbo].[RLP_17]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_17]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_17]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_17]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_17] 
SET [Machine Name] = 'RLP_17' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_17]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[RLP_17]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[RLP_17_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_17]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[RLP_17_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_17_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[RLP_17_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_17] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[RLP_17_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'RLP_17'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_17_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[RLP_18] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'RLP_18%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'RLP_18 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[RLP_18_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'RLP_18 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[RLP_18_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[RLP_18]
SET    [PxC_DB].[dbo].[RLP_18].StartTime = [PxC_DB].[dbo].[RLP_18_TEST].[StartTime],
       [PxC_DB].[dbo].[RLP_18].Duration = [PxC_DB].[dbo].[RLP_18_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[RLP_18_TEST]
WHERE [PxC_DB].[dbo].[RLP_18_TEST].[TraID] = [PxC_DB].[dbo].[RLP_18].[TraID] AND [PxC_DB].[dbo].[RLP_18].StartTime IS NULL AND [PxC_DB].[dbo].[RLP_18].Duration IS NULL

 UPDATE [PxC_DB].[dbo].[RLP_18] 
 SET Reason = 'RLP_18 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[RLP_18_TEST]

UPDATE [PxC_DB].[dbo].[RLP_18]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_18]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_18]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_18]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL


UPDATE [PxC_DB].[dbo].[RLP_18] 
	SET [Machine Name] = 'RLP_18' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_18]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[RLP_18]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[RLP_18_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_18]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')



UPDATE [PxC_DB].[dbo].[RLP_18_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_18_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[RLP_18_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_18] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[RLP_18_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'RLP_18'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_18_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[RLP_14] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'RLP_14%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'RLP_14 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[RLP_14_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'RLP_14 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[RLP_14_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[RLP_14]
SET    [PxC_DB].[dbo].[RLP_14].StartTime = [PxC_DB].[dbo].[RLP_14_TEST].[StartTime],
       [PxC_DB].[dbo].[RLP_14].Duration = [PxC_DB].[dbo].[RLP_14_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[RLP_14_TEST]
WHERE [PxC_DB].[dbo].[RLP_14_TEST].[TraID] = [PxC_DB].[dbo].[RLP_14].[TraID] AND [PxC_DB].[dbo].[RLP_14].StartTime IS NULL AND [PxC_DB].[dbo].[RLP_14].Duration IS NULL

 UPDATE [PxC_DB].[dbo].[RLP_14] 
  SET Reason = 'RLP_14 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[RLP_14_TEST]

UPDATE [PxC_DB].[dbo].[RLP_14]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_14]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_14]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_14]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_14] 
	SET [Machine Name] = 'RLP_14' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_14]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[RLP_14]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[RLP_14_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_14]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[RLP_14_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_14_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[RLP_14_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_14] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[RLP_14_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'RLP_14'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_14_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[RLP_7] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'RLP_7%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'RLP_7 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[RLP_7_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'RLP_7 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[RLP_7_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[RLP_7]
SET    [PxC_DB].[dbo].[RLP_7].StartTime = [PxC_DB].[dbo].[RLP_7_TEST].[StartTime],
       [PxC_DB].[dbo].[RLP_7].Duration = [PxC_DB].[dbo].[RLP_7_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[RLP_7_TEST]
WHERE [PxC_DB].[dbo].[RLP_7_TEST].[TraID] = [PxC_DB].[dbo].[RLP_7].[TraID] AND [PxC_DB].[dbo].[RLP_7].StartTime IS NULL AND [PxC_DB].[dbo].[RLP_7].Duration IS NULL

UPDATE [PxC_DB].[dbo].[RLP_7] 
 SET Reason = 'RLP_7 - Idle Time' WHERE Reason IS NULL 

TRUNCATE TABLE [PxC_DB].[dbo].[RLP_7_TEST]

UPDATE [PxC_DB].[dbo].[RLP_7]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_7]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_7]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_7]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL


UPDATE [PxC_DB].[dbo].[RLP_7] 
	SET [Machine Name] = 'RLP_7' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_7]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[RLP_7]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[RLP_7_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_7]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[RLP_7_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_7_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[RLP_7_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_7] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[RLP_7_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'RLP_7'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_7_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[RLP_5] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'RLP_5%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'RLP_5 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[RLP_5_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'RLP_5 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[RLP_5_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[RLP_5]
SET    [PxC_DB].[dbo].[RLP_5].StartTime = [PxC_DB].[dbo].[RLP_5_TEST].[StartTime],
       [PxC_DB].[dbo].[RLP_5].Duration = [PxC_DB].[dbo].[RLP_5_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[RLP_5_TEST]
WHERE [PxC_DB].[dbo].[RLP_5_TEST].[TraID] = [PxC_DB].[dbo].[RLP_5].[TraID] AND [PxC_DB].[dbo].[RLP_5].StartTime IS NULL AND [PxC_DB].[dbo].[RLP_5].Duration IS NULL

UPDATE [PxC_DB].[dbo].[RLP_5] 
SET Reason = 'RLP_5 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[RLP_5_TEST]

UPDATE [PxC_DB].[dbo].[RLP_5]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_5]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_5]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_5]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL


UPDATE [PxC_DB].[dbo].[RLP_5] 
	SET [Machine Name] = 'RLP_5' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_5]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[RLP_5]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[RLP_5_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_5]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[RLP_5_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_5_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[RLP_5_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_5] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[RLP_5_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'RLP_5'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_5_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[RLP_6] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'RLP_6%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'RLP_6 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[RLP_6_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'RLP_6 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[RLP_6_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[RLP_6]
SET    [PxC_DB].[dbo].[RLP_6].StartTime = [PxC_DB].[dbo].[RLP_6_TEST].[StartTime],
       [PxC_DB].[dbo].[RLP_6].Duration = [PxC_DB].[dbo].[RLP_6_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[RLP_6_TEST]
WHERE [PxC_DB].[dbo].[RLP_6_TEST].[TraID] = [PxC_DB].[dbo].[RLP_6].[TraID] AND [PxC_DB].[dbo].[RLP_6].StartTime IS NULL AND [PxC_DB].[dbo].[RLP_6].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[RLP_6] 
SET Reason = 'RLP_6 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[RLP_6_TEST]

UPDATE [PxC_DB].[dbo].[RLP_6]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_6]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_6]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_6]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_6] 
	SET [Machine Name] = 'RLP_6' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_6]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[RLP_6]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[RLP_6_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_6]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[RLP_6_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_6_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[RLP_6_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_6] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[RLP_6_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'RLP_6'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_6_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[RLP_8] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'RLP_8%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'RLP_8 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[RLP_8_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'RLP_8 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[RLP_8_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[RLP_8]
SET    [PxC_DB].[dbo].[RLP_8].StartTime = [PxC_DB].[dbo].[RLP_8_TEST].[StartTime],
       [PxC_DB].[dbo].[RLP_8].Duration = [PxC_DB].[dbo].[RLP_8_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[RLP_8_TEST]
WHERE [PxC_DB].[dbo].[RLP_8_TEST].[TraID] = [PxC_DB].[dbo].[RLP_8].[TraID] AND [PxC_DB].[dbo].[RLP_8].StartTime IS NULL AND [PxC_DB].[dbo].[RLP_8].Duration IS NULL

UPDATE [PxC_DB].[dbo].[RLP_8] 
SET Reason = 'RLP_8 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[RLP_8_TEST]

UPDATE [PxC_DB].[dbo].[RLP_8]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_8]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_8]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_8]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_8] 
	SET [Machine Name] = 'RLP_8' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[RLP_8]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[RLP_8]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[RLP_8_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[RLP_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[RLP_8_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_8_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[RLP_8_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[RLP_8] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[RLP_8_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'RLP_8'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[RLP_8_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[TPA 60_1] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'TPA 60_1%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'TPA 60_1 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[TPA 60_1_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'TPA 60_1 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[TPA 60_1_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[TPA 60_1]
SET    [PxC_DB].[dbo].[TPA 60_1].StartTime = [PxC_DB].[dbo].[TPA 60_1_TEST].[StartTime],
       [PxC_DB].[dbo].[TPA 60_1].Duration = [PxC_DB].[dbo].[TPA 60_1_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[TPA 60_1_TEST]
WHERE [PxC_DB].[dbo].[TPA 60_1_TEST].[TraID] = [PxC_DB].[dbo].[TPA 60_1].[TraID] AND [PxC_DB].[dbo].[TPA 60_1].StartTime IS NULL AND [PxC_DB].[dbo].[TPA 60_1].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[TPA 60_1]
SET Reason = 'TPA 60_1 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[TPA 60_1_TEST]

UPDATE [PxC_DB].[dbo].[TPA 60_1]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 60_1]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 60_1]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 60_1]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 60_1] 
	SET [Machine Name] = 'TPA 60_1' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 60_1]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[TPA 60_1]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[TPA 60_1_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 60_1]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[TPA 60_1_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 60_1_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[TPA 60_1_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 60_1] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[TPA 60_1_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'TPA 60_1'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 60_1_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[TPA 50_8] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'TPA 50_8%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'TPA 50_8 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[TPA 50_8_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'TPA 50_8 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[TPA 50_8_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[TPA 50_8]
SET    [PxC_DB].[dbo].[TPA 50_8].StartTime = [PxC_DB].[dbo].[TPA 50_8_TEST].[StartTime],
       [PxC_DB].[dbo].[TPA 50_8].Duration = [PxC_DB].[dbo].[TPA 50_8_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[TPA 50_8_TEST]
WHERE [PxC_DB].[dbo].[TPA 50_8_TEST].[TraID] = [PxC_DB].[dbo].[TPA 50_8].[TraID] AND [PxC_DB].[dbo].[TPA 50_8].StartTime IS NULL AND [PxC_DB].[dbo].[TPA 50_8].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[TPA 50_8]
SET Reason = 'TPA 50_8 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[TPA 50_8_TEST]

UPDATE [PxC_DB].[dbo].[TPA 50_8]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 50_8]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 50_8]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 50_8]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 50_8] 
	SET [Machine Name] = 'TPA 50_8' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 50_8]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[TPA 50_8]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[TPA 50_8_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_8]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[TPA 50_8_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 50_8_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[TPA 50_8_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_8] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[TPA 50_8_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'TPA 50_8'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 50_8_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[TPA 50_9] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'TPA 50_9%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'TPA 50_9 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[TPA 50_9_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'TPA 50_9 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[TPA 50_9_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[TPA 50_9]
SET    [PxC_DB].[dbo].[TPA 50_9].StartTime = [PxC_DB].[dbo].[TPA 50_9_TEST].[StartTime],
       [PxC_DB].[dbo].[TPA 50_9].Duration = [PxC_DB].[dbo].[TPA 50_9_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[TPA 50_9_TEST]
WHERE [PxC_DB].[dbo].[TPA 50_9_TEST].[TraID] = [PxC_DB].[dbo].[TPA 50_9].[TraID] AND [PxC_DB].[dbo].[TPA 50_9].StartTime IS NULL AND [PxC_DB].[dbo].[TPA 50_9].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[TPA 50_9]
SET Reason = 'TPA 50_9 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[TPA 50_9_TEST]

UPDATE [PxC_DB].[dbo].[TPA 50_9]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 50_9]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 50_9]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 50_9]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 50_9] 
	SET [Machine Name] = 'TPA 50_9' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 50_9]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[TPA 50_9]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[TPA 50_9_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 50_9]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[TPA 50_9_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 50_9_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[TPA 50_9_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 50_9] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[TPA 50_9_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'TPA 50_9'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 50_9_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[TPA 30_3] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'TPA 30_3%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'TPA 30_3 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[TPA 30_3_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'TPA 30_3 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[TPA 30_3_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[TPA 30_3]
SET    [PxC_DB].[dbo].[TPA 30_3].StartTime = [PxC_DB].[dbo].[TPA 30_3_TEST].[StartTime],
       [PxC_DB].[dbo].[TPA 30_3].Duration = [PxC_DB].[dbo].[TPA 30_3_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[TPA 30_3_TEST]
WHERE [PxC_DB].[dbo].[TPA 30_3_TEST].[TraID] = [PxC_DB].[dbo].[TPA 30_3].[TraID] AND [PxC_DB].[dbo].[TPA 30_3].StartTime IS NULL AND [PxC_DB].[dbo].[TPA 30_3].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[TPA 30_3]
SET Reason = 'TPA 30_3 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[TPA 30_3_TEST]

UPDATE [PxC_DB].[dbo].[TPA 30_3]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 30_3]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 30_3]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 30_3]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 30_3] 
	SET [Machine Name] = 'TPA 30_3' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 30_3]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[TPA 30_3]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[TPA 30_3_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[TPA 30_3_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 30_3_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[TPA 30_3_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_3] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[TPA 30_3_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'TPA 30_3'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 30_3_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[TPA 30_4] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'TPA 30_4%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'TPA 30_4 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[TPA 30_4_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'TPA 30_4 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[TPA 30_4_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[TPA 30_4]
SET    [PxC_DB].[dbo].[TPA 30_4].StartTime = [PxC_DB].[dbo].[TPA 30_4_TEST].[StartTime],
       [PxC_DB].[dbo].[TPA 30_4].Duration = [PxC_DB].[dbo].[TPA 30_4_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[TPA 30_4_TEST]
WHERE [PxC_DB].[dbo].[TPA 30_4_TEST].[TraID] = [PxC_DB].[dbo].[TPA 30_4].[TraID] AND [PxC_DB].[dbo].[TPA 30_4].StartTime IS NULL AND [PxC_DB].[dbo].[TPA 30_4].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[TPA 30_4]
SET Reason = 'TPA 30_4 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[TPA 30_4_TEST]

UPDATE [PxC_DB].[dbo].[TPA 30_4]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 30_4]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 30_4]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 30_4]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 30_4] 
	SET [Machine Name] = 'TPA 30_4' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 30_4]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[TPA 30_4]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[TPA 30_4_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 30_4]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[TPA 30_4_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 30_4_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[TPA 30_4_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 30_4] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[TPA 30_4_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'TPA 30_4'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 30_4_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[TPA 6_2] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'TPA 6_2%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'TPA 6_2 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[TPA 6_2_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'TPA 6_2 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[TPA 6_2_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[TPA 6_2]
SET    [PxC_DB].[dbo].[TPA 6_2].StartTime = [PxC_DB].[dbo].[TPA 6_2_TEST].[StartTime],
       [PxC_DB].[dbo].[TPA 6_2].Duration = [PxC_DB].[dbo].[TPA 6_2_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[TPA 6_2_TEST]
WHERE [PxC_DB].[dbo].[TPA 6_2_TEST].[TraID] = [PxC_DB].[dbo].[TPA 6_2].[TraID] AND [PxC_DB].[dbo].[TPA 6_2].StartTime IS NULL AND [PxC_DB].[dbo].[TPA 6_2].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[TPA 6_2]
SET Reason = 'TPA 6_2 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[TPA 6_2_TEST]

UPDATE [PxC_DB].[dbo].[TPA 6_2]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 6_2]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 6_2]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 6_2]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 6_2] 
	SET [Machine Name] = 'TPA 6_2' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 6_2]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[TPA 6_2]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[TPA 6_2_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_2]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[TPA 6_2_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 6_2_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[TPA 6_2_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_2] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[TPA 6_2_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'TPA 6_2'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 6_2_OCCURANCE])	
		 
INSERT INTO [PxC_DB].[dbo].[TPA 6_3] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'TPA 6_3%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'TPA 6_3 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[TPA 6_3_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'TPA 6_3 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[TPA 6_3_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[TPA 6_3]
SET    [PxC_DB].[dbo].[TPA 6_3].StartTime = [PxC_DB].[dbo].[TPA 6_3_TEST].[StartTime],
       [PxC_DB].[dbo].[TPA 6_3].Duration = [PxC_DB].[dbo].[TPA 6_3_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[TPA 6_3_TEST]
WHERE [PxC_DB].[dbo].[TPA 6_3_TEST].[TraID] = [PxC_DB].[dbo].[TPA 6_3].[TraID] AND [PxC_DB].[dbo].[TPA 6_3].StartTime IS NULL AND [PxC_DB].[dbo].[TPA 6_3].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[TPA 6_3]
SET Reason = 'TPA 6_3 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[TPA 6_3_TEST]

UPDATE [PxC_DB].[dbo].[TPA 6_3]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 6_3]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 6_3]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 6_3]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 6_3] 
	SET [Machine Name] = 'TPA 6_3' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 6_3]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[TPA 6_3]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[TPA 6_3_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 6_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[TPA 6_3_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 6_3_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[TPA 6_3_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 6_3] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[TPA 6_3_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'TPA 6_3'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 6_3_OCCURANCE])
		 
INSERT INTO [PxC_DB].[dbo].[DACS 15] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'DACS 15%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'DACS 15 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[DACS 15_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'DACS 15 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[DACS 15_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[DACS 15]
SET    [PxC_DB].[dbo].[DACS 15].StartTime = [PxC_DB].[dbo].[DACS 15_TEST].[StartTime],
       [PxC_DB].[dbo].[DACS 15].Duration = [PxC_DB].[dbo].[DACS 15_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[DACS 15_TEST]
WHERE [PxC_DB].[dbo].[DACS 15_TEST].[TraID] = [PxC_DB].[dbo].[DACS 15].[TraID] AND [PxC_DB].[dbo].[DACS 15].StartTime IS NULL AND [PxC_DB].[dbo].[DACS 15].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[DACS 15]
SET Reason = 'DACS 15 - Idle Time' WHERE Reason IS NULL

UPDATE [PxC_DB].[dbo].[DACS 15] 
SET [Reason] = 'DACS 15 - Idle Time' where [Reason] = 'DACS 15 - Stop' 

TRUNCATE TABLE [PxC_DB].[dbo].[DACS 15_TEST]

UPDATE [PxC_DB].[dbo].[DACS 15]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[DACS 15]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[DACS 15]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[DACS 15]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[DACS 15] 
	SET [Machine Name] = 'DACS 15' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[DACS 15]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[DACS 15]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[DACS 15_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 15]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[DACS 15_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[DACS 15_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[DACS 15_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 15] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[DACS 15_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'DACS 15'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[DACS 15_OCCURANCE])
		 
INSERT INTO [PxC_DB].[dbo].[DACS 30] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'DACS 30%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'DACS 30 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[DACS 30_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'DACS 30 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[DACS 30_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[DACS 30]
SET    [PxC_DB].[dbo].[DACS 30].StartTime = [PxC_DB].[dbo].[DACS 30_TEST].[StartTime],
       [PxC_DB].[dbo].[DACS 30].Duration = [PxC_DB].[dbo].[DACS 30_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[DACS 30_TEST]
WHERE [PxC_DB].[dbo].[DACS 30_TEST].[TraID] = [PxC_DB].[dbo].[DACS 30].[TraID] AND [PxC_DB].[dbo].[DACS 30].StartTime IS NULL AND [PxC_DB].[dbo].[DACS 30].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[DACS 30]
SET Reason = 'DACS 30 - Idle Time' WHERE Reason IS NULL

UPDATE [PxC_DB].[dbo].[DACS 30] 
SET [Reason] = 'DACS 30 - Idle Time' where [Reason] = 'DACS 30 - Stop' 

TRUNCATE TABLE [PxC_DB].[dbo].[DACS 30_TEST]

UPDATE [PxC_DB].[dbo].[DACS 30]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[DACS 30]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[DACS 30]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[DACS 30]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[DACS 30] 
	SET [Machine Name] = 'DACS 30' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[DACS 30]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[DACS 30]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[DACS 30_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[DACS 30]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[DACS 30_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[DACS 30_Stoppage])
		      
 
INSERT INTO [PxC_DB].[dbo].[DACS 30_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[DACS 30] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[DACS 30_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'DACS 30'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[DACS 30_OCCURANCE])

INSERT INTO [PxC_DB].[dbo].[TPA 12_3] ([StopTime], [Reason], [TraID])
        (Select  [LocalCol], [NextEvDescCol], [TraID] From 
        (Select [LocalCol], [EvDescCol], [EventCol], [TraID], 
        Lead([EvDescCol]) OVER(ORDER BY LocalCol) As NextEvDescCol From 
        (Select * From [PxC_DB].[dbo].[Alarms] 
        Where [EvDescCol] Like 'TPA 12_3%' And LocalCol >= @STARTDATE And LocalCol <= @ENDDATE)As x)As y  
        Where [EvDescCol] = 'TPA 12_3 - Stop' And [EventCol] = 'ALARM ON') 
		
INSERT INTO [PxC_DB].[dbo].[TPA 12_3_TEST] ([StartTime], [Duration], [TraID])
(SELECT  [LocalCol] , [DurCol], [TraID]  FROM [PxC_DB].[dbo].[Alarms] WHERE EvDescCol = 'TPA 12_3 - Stop' 
And [LocalCol] >= @STARTDATE  And [LocalCol] <= @ENDDATE And [EventCol] = 'ALARM OFF')

UPDATE [PxC_DB].[dbo].[TPA 12_3_TEST]
SET [DurationNEW] = Duration/60.0

UPDATE [PxC_DB].[dbo].[TPA 12_3]
SET    [PxC_DB].[dbo].[TPA 12_3].StartTime = [PxC_DB].[dbo].[TPA 12_3_TEST].[StartTime],
       [PxC_DB].[dbo].[TPA 12_3].Duration = [PxC_DB].[dbo].[TPA 12_3_TEST].[DurationNEW]
FROM 
[PxC_DB].[dbo].[TPA 12_3_TEST]
WHERE [PxC_DB].[dbo].[TPA 12_3_TEST].[TraID] = [PxC_DB].[dbo].[TPA 12_3].[TraID] AND [PxC_DB].[dbo].[TPA 12_3].StartTime IS NULL AND [PxC_DB].[dbo].[TPA 12_3].Duration IS NULL 

UPDATE [PxC_DB].[dbo].[TPA 12_3]
SET Reason = 'TPA 12_3 - Idle Time' WHERE Reason IS NULL

TRUNCATE TABLE [PxC_DB].[dbo].[TPA 12_3_TEST]

UPDATE [PxC_DB].[dbo].[TPA 12_3]
SET [SHIFT] = 'B' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '13:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '21:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_3]
SET [SHIFT] = 'A' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '05:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '13:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_3]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '21:59:58' AND CONVERT(VARCHAR, [StartTime], 108) <= '23:59:59' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_3]
SET [SHIFT] = 'C' WHERE CONVERT(VARCHAR, [StartTime], 108) >= '00:00:01' AND CONVERT(VARCHAR, [StartTime], 108) <= '05:59:55' AND [SHIFT] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_3] 
	SET [Machine Name] = 'TPA 12_3' WHERE [Machine Name] IS NULL

UPDATE [PxC_DB].[dbo].[TPA 12_3]
SET [DAY] = @DAY WHERE [DAY] IS NULL AND NOT [SHIFT] = 'C'

UPDATE [PxC_DB].[dbo].[TPA 12_3]
SET [DAY] = @DAYNEW WHERE [DAY] IS NULL AND [SHIFT] = 'C'

INSERT INTO [PxC_DB].[dbo].[TPA 12_3_Stoppage] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault], [Idle Time], [Stop]) 
SELECT (SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Adaptor Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Automat Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Burr_Flash Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Channel Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Chipping'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Cleaning_Oiling_Tightening'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Conveyor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Crack Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Density Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Die Return Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Dimension Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Filler Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Floor Cleaning'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Geometry Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Granulate Rework'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Gripper Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Hopper Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Lunch or Dinner'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Manpower Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Material_Grade Change'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Mech Maint_Elect Prob'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Plan'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Operator is not available'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Others Break'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Planned Maintenance'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Pull Out Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Raged Edge'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sensor Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Sticking'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Delay'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Forced'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Change Planned'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Jamming'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tool Problem'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Trails'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray Unloading'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tray_Acce Shortage'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Utility AC Power Air'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Weight Variation'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Emergency Pressed'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor Covered Safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Motor O_L Tripped'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Product Count Complete'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Tools Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Punch Safety Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Top Tool safety'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Low Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%High Pressure Load Monitor'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%RAM Adj_Motor Trip'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Oil Filter Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Area Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%No Powder'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Air Pressure Low'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Part Sensor Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Up Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Down Position Reached'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]  
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Max Pressure Reached PS'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%DZP Sensor Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 1 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Precompaction Failure'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Rear Door Open'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Press Stop From Automat'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 2 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Safety Laser 3 Fault'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Failure Protective Door'), 
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Min Pressure Fault'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Idle Time'),
(SELECT SUM(Duration)  FROM  [PxC_DB].[dbo].[TPA 12_3]
WHERE [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE
AND [Reason] LIKE '%Stop')


UPDATE [PxC_DB].[dbo].[TPA 12_3_Stoppage]
		 SET [LocalCol] = @ENDDATE WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 12_3_Stoppage])

		      
 
INSERT INTO [PxC_DB].[dbo].[TPA 12_3_OCCURANCE] ([Adaptor Jamming], [Automat Problem], [Burr_Flash Problem], [Channel Problem], [Chipping], [Cleaning_Oiling_Tightening], 
[Conveyor Problem], [Crack Problem], [Density Problem], [Die Return Problem], [Dimension Variation], [Filler Problem], [Floor Cleaning], [Geometry Change], [Granulate Rework],
[Gripper Problem], [Hopper Jamming], [Lunch or Dinner], [Manpower Shortage], [Material Shortage], [Material_Grade Change], [Mech Maint_Elect Prob], [No Plan], 
[Operator is not available], [Others Break], [Planned Maintenance], [Pull Out Problem], [Raged Edge], [Sensor Problem], [Sticking], [Tool Change Delay], [Tool Change Forced], 
[Tool Change Planned], [Tool Jamming], [Tool Problem], [Trails], [Tray Unloading], [Tray_Acce Shortage], [Utility AC Power Air], [Weight Variation], [Emergency Pressed], 
[Motor Covered Safety], [Motor O_L Tripped], [Product Count Complete], [Tools Safety Fault], [Top Punch Safety Fault], [Top Tool safety], [Oil Pressure Low], 
[Low Pressure Load Monitor], [High Pressure Load Monitor], [RAM Adj_Motor Trip], [Oil Filter Fault], [Area Sensor Failure], [No Powder], [Air Pressure Low], [Part Sensor Failure], 
[Max Up Position Reached], [Max Down Position Reached], [Max Pressure Reached PS], [DZP Sensor Fault], [Safety Laser 1 Fault], [Precompaction Failure], [Rear Door Open],
[Press Stop From Automat], [Safety Laser 2 Fault], [Safety Laser 3 Fault], [Failure Protective Door], [Min Pressure Fault])  
Select (Select Count(*) From
(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Adaptor Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As ConveyorProblem),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Automat Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AUTOMAT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Burr_Flash Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As BURR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Channel Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Chipping' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CHI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Cleaning_Oiling_Tightening' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CLI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Conveyor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CON),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Crack Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As CRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Density Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DEN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Die Return Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Dimension Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DIME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Filler Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FILLE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Floor Cleaning' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FLOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Geometry Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GEOM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Granulate Rework' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRAN),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Gripper Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As GRIP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Hopper Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Lunch or Dinner' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LUNC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Manpower Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MANP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Material Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Material_Grade Change' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MATG),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Mech Maint_Elect Prob' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MECH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%No Plan' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Operator is not available' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OPE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Others Break' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OTH),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Planned Maintenance' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PLA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Pull Out Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PULLO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Raged Edge' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAGE),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Sensor Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SENS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Sticking' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As STI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Tool Change Delay' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Tool Change Forced' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Tool Change Planned' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Tool Jamming' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOJ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Tool Problem' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Trails' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Tray Unloading' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Tray_Acce Shortage' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TRAY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Utility AC Power Air' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As UTI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Weight Variation' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As WEI),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Emergency Pressed' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As EME),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Motor Covered Safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Motor O_L Tripped' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MOTO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Product Count Complete' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Tools Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOOLS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Top Punch Safety Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Top Tool safety' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As TOPT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Oil Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OILP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Low Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As LOWP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%High Pressure Load Monitor' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As HIGHP),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%RAM Adj_Motor Trip' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As RAM),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Oil Filter Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As OIL),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Area Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AREA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%No Powder' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As NOPO),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Air Pressure Low' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As AR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Part Sensor Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PR),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Max Up Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Max Down Position Reached' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAD),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Max Pressure Reached PS' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MAPS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%DZP Sensor Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As DZ),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Safety Laser 1 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAS),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Precompaction Failure' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRC),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Rear Door Open' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As REA),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Press Stop From Automat' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As PRT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Safety Laser 2 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFT),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Safety Laser 3 Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As SAFTY),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Failure Protective Door' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As FAILU),
		 (Select Count(*) From(Select * From [PxC_DB].[dbo].[TPA 12_3] Where 
         [Reason] Like '%Min Pressure Fault' AND [StartTime] >= @STARTDATE AND [StartTime] <=  @ENDDATE) As MPF)

		 UPDATE [PxC_DB].[dbo].[TPA 12_3_OCCURANCE]
		 SET [LocalCol] = @ENDDATE, [SHIFT] = @SHIFT, [Machine Name] = 'TPA 12_3'  WHERE [RowID] = (SELECT MAX(RowID) FROM [PxC_DB].[dbo].[TPA 12_3_OCCURANCE])
		 
UPDATE [PxC_DB].[dbo].[RLP_15] 
SET Reason = 'RLP_15 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[RLP_15]
SET Reason = 'RLP_15 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_15]
SET Reason = 'RLP_15 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_14] 
SET Reason = 'RLP_14 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[RLP_14] 
SET Reason = 'RLP_14 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_14] 
SET Reason = 'RLP_14 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_13] 
SET Reason = 'RLP_13 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[RLP_13] 
SET Reason = 'RLP_13 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_13] 
SET Reason = 'RLP_13 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_17] 
SET Reason = 'RLP_17 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[RLP_17] 
SET Reason = 'RLP_17 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_17] 
SET Reason = 'RLP_17 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_18] 
SET Reason = 'RLP_18 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[RLP_18] 
SET Reason = 'RLP_18 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_18] 
SET Reason = 'RLP_18 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_5] 
SET Reason = 'RLP_5 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[RLP_5] 
SET Reason = 'RLP_5 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_5] 
SET Reason = 'RLP_5 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY	

UPDATE [PxC_DB].[dbo].[RLP_6] 
SET Reason = 'RLP_6 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[RLP_6] 
SET Reason = 'RLP_6 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_6] 
SET Reason = 'RLP_6 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY	

UPDATE [PxC_DB].[dbo].[RLP_7] 
SET Reason = 'RLP_7 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[RLP_7] 
SET Reason = 'RLP_7 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_7] 
SET Reason = 'RLP_7 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_8] 
SET Reason = 'RLP_8 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[RLP_8] 
SET Reason = 'RLP_8 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_8] 
SET Reason = 'RLP_8 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_9] 
SET Reason = 'RLP_9 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[RLP_9] 
SET Reason = 'RLP_9 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_9] 
SET Reason = 'RLP_9 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY	

UPDATE [PxC_DB].[dbo].[TPA 12_1]
SET Reason = 'TPA 12_1 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[TPA 12_1] 
SET Reason = 'TPA 12_1 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 12_1] 
SET Reason = 'TPA 12_1 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 12_2]
SET Reason = 'TPA 12_2 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[TPA 12_2] 
SET Reason = 'TPA 12_2 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 12_2] 
SET Reason = 'TPA 12_2 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 12_3]
SET Reason = 'TPA 12_3 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[TPA 12_3] 
SET Reason = 'TPA 12_3 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 12_3] 
SET Reason = 'TPA 12_3 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 12_4]
SET Reason = 'TPA 12_4 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[TPA 12_4] 
SET Reason = 'TPA 12_4 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 12_4] 
SET Reason = 'TPA 12_4 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 16_3]
SET Reason = 'TPA 16_3 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[TPA 16_3] 
SET Reason = 'TPA 16_3 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 16_3] 
SET Reason = 'TPA 16_3 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 16_4]
SET Reason = 'TPA 16_4 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[TPA 16_4] 
SET Reason = 'TPA 16_4 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 16_4] 
SET Reason = 'TPA 16_4 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 16_5]
SET Reason = 'TPA 16_5 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[TPA 16_5] 
SET Reason = 'TPA 16_5 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 16_5] 
SET Reason = 'TPA 16_5 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY	

UPDATE [PxC_DB].[dbo].[TPA 16_6]
SET Reason = 'TPA 16_6 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[TPA 16_6] 
SET Reason = 'TPA 16_6 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 16_6] 
SET Reason = 'TPA 16_6 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 60_1]
SET Reason = 'TPA 60_1 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[TPA 60_1] 
SET Reason = 'TPA 60_1 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 60_1] 
SET Reason = 'TPA 60_1 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY 

UPDATE [PxC_DB].[dbo].[TPA 35_1]
SET Reason = 'TPA 35_1 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[TPA 35_1] 
SET Reason = 'TPA 35_1 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 35_1] 
SET Reason = 'TPA 35_1 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY	

UPDATE [PxC_DB].[dbo].[TPA 50_8]
SET Reason = 'TPA 50_8 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[TPA 50_8] 
SET Reason = 'TPA 50_8 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 50_8] 
SET Reason = 'TPA 50_8 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 50_9]
SET Reason = 'TPA 50_9 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[TPA 50_9] 
SET Reason = 'TPA 50_9 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 50_9] 
SET Reason = 'TPA 50_9 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY	

UPDATE [PxC_DB].[dbo].[TPA 30_3]
SET Reason = 'TPA 30_3 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[TPA 30_3] 
SET Reason = 'TPA 30_3 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 30_3] 
SET Reason = 'TPA 30_3 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 30_4]
SET Reason = 'TPA 30_4 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[TPA 30_4] 
SET Reason = 'TPA 30_4 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 30_4] 
SET Reason = 'TPA 30_4 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY 

UPDATE [PxC_DB].[dbo].[TPA 6_2]
SET Reason = 'TPA 6_2 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[TPA 6_2] 
SET Reason = 'TPA 6_2 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 6_2] 
SET Reason = 'TPA 6_2 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 6_3]
SET Reason = 'TPA 6_3 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[TPA 6_3] 
SET Reason = 'TPA 6_3 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[TPA 6_3] 
SET Reason = 'TPA 6_3 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[DACS 15]
SET Reason = 'DACS 15 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[DACS 15] 
SET Reason = 'DACS 15 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[DACS 15] 
SET Reason = 'DACS 15 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[DACS 30]
SET Reason = 'DACS 30 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '05:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '05:59:59' AND [DAY] = @DAYNEW

UPDATE [PxC_DB].[dbo].[DACS 30] 
SET Reason = 'DACS 30 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '13:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '13:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[DACS 30] 
SET Reason = 'DACS 30 - Idle Time' WHERE CONVERT(VARCHAR, [StopTime], 108) >= '21:59:57' and CONVERT(VARCHAR, [StopTime], 108) <= '21:59:59' AND [DAY] = @DAY

UPDATE [PxC_DB].[dbo].[RLP_15]
SET Reason =REPLACE(Reason, 'RLP_15 - ', ' ') WHERE Reason LIKE 'RLP_15 - %'

UPDATE [PxC_DB].[dbo].[RLP_14]
SET Reason =REPLACE(Reason, 'RLP_14 - ', ' ') WHERE Reason LIKE 'RLP_14 - %'

UPDATE [PxC_DB].[dbo].[RLP_13]
SET Reason =REPLACE(Reason, 'RLP_13 - ', ' ') WHERE Reason LIKE 'RLP_13 - %'

UPDATE [PxC_DB].[dbo].[RLP_17]
SET Reason =REPLACE(Reason, 'RLP_17 - ', ' ') WHERE Reason LIKE 'RLP_17 - %'

UPDATE [PxC_DB].[dbo].[RLP_18]
SET Reason =REPLACE(Reason, 'RLP_18 - ', ' ') WHERE Reason LIKE 'RLP_18 - %'	

UPDATE [PxC_DB].[dbo].[RLP_5]
SET Reason =REPLACE(Reason, 'RLP_5 - ', ' ') WHERE Reason LIKE 'RLP_5 - %'	

UPDATE [PxC_DB].[dbo].[RLP_6]
SET Reason =REPLACE(Reason, 'RLP_6 - ', ' ') WHERE Reason LIKE 'RLP_6 - %' 

UPDATE [PxC_DB].[dbo].[RLP_7]
SET Reason =REPLACE(Reason, 'RLP_7 - ', ' ') WHERE Reason LIKE 'RLP_7 - %'	

UPDATE [PxC_DB].[dbo].[RLP_8]
SET Reason =REPLACE(Reason, 'RLP_8 - ', ' ') WHERE Reason LIKE 'RLP_8 - %' 

UPDATE [PxC_DB].[dbo].[RLP_9]
SET Reason =REPLACE(Reason, 'RLP_9 - ', ' ') WHERE Reason LIKE 'RLP_9 - %'

UPDATE [PxC_DB].[dbo].[TPA 12_1]
SET Reason =REPLACE(Reason, 'TPA 12_1 - ', ' ') WHERE Reason LIKE 'TPA 12_1 - %'

UPDATE [PxC_DB].[dbo].[TPA 12_2]
SET Reason =REPLACE(Reason, 'TPA 12_2 - ', ' ') WHERE Reason LIKE 'TPA 12_2 - %'

UPDATE [PxC_DB].[dbo].[TPA 12_3]
SET Reason =REPLACE(Reason, 'TPA 12_3 - ', ' ') WHERE Reason LIKE 'TPA 12_3 - %'

UPDATE [PxC_DB].[dbo].[TPA 12_4]
SET Reason =REPLACE(Reason, 'TPA 12_4 - ', ' ') WHERE Reason LIKE 'TPA 12_4 - %'

UPDATE [PxC_DB].[dbo].[TPA 16_3]
SET Reason =REPLACE(Reason, 'TPA 16_3 - ', ' ') WHERE Reason LIKE 'TPA 16_3 - %'

UPDATE [PxC_DB].[dbo].[TPA 16_4]
SET Reason =REPLACE(Reason, 'TPA 16_4 - ', ' ') WHERE Reason LIKE 'TPA 16_4 - %'

UPDATE [PxC_DB].[dbo].[TPA 16_5]
SET Reason =REPLACE(Reason, 'TPA 16_5 - ', ' ') WHERE Reason LIKE 'TPA 16_5 - %'

UPDATE [PxC_DB].[dbo].[TPA 16_6]
SET Reason =REPLACE(Reason, 'TPA 16_6 - ', ' ') WHERE Reason LIKE 'TPA 16_6 - %'

UPDATE [PxC_DB].[dbo].[TPA 60_1]
SET Reason =REPLACE(Reason, 'TPA 60_1 - ', ' ') WHERE Reason LIKE 'TPA 60_1 - %'

UPDATE [PxC_DB].[dbo].[TPA 35_1]
SET Reason =REPLACE(Reason, 'TPA 35_1 - ', ' ') WHERE Reason LIKE 'TPA 35_1 - %'

UPDATE [PxC_DB].[dbo].[TPA 30_3]
SET Reason =REPLACE(Reason, 'TPA 30_3 - ', ' ') WHERE Reason LIKE 'TPA 30_3 - %'

UPDATE [PxC_DB].[dbo].[TPA 30_4]
SET Reason =REPLACE(Reason, 'TPA 30_4 - ', ' ') WHERE Reason LIKE 'TPA 30_4 - %'

UPDATE [PxC_DB].[dbo].[TPA 50_8]
SET Reason =REPLACE(Reason, 'TPA 50_8 - ', ' ') WHERE Reason LIKE 'TPA 50_8 - %'

UPDATE [PxC_DB].[dbo].[TPA 50_9]
SET Reason =REPLACE(Reason, 'TPA 50_9 - ', ' ') WHERE Reason LIKE 'TPA 50_9 - %'

UPDATE [PxC_DB].[dbo].[TPA 6_2]
SET Reason =REPLACE(Reason, 'TPA 6_2 - ', ' ') WHERE Reason LIKE 'TPA 6_2 - %'

UPDATE [PxC_DB].[dbo].[TPA 6_3]
SET Reason =REPLACE(Reason, 'TPA 6_3 - ', ' ') WHERE Reason LIKE 'TPA 6_3 - %'

UPDATE [PxC_DB].[dbo].[DACS 15]
SET Reason =REPLACE(Reason, 'DACS 15 - ', ' ') WHERE Reason LIKE 'DACS 15 - %'

UPDATE [PxC_DB].[dbo].[DACS 30]
SET Reason =REPLACE(Reason, 'DACS 30 - ', ' ') WHERE Reason LIKE 'DACS 30 - %'

END